/* 2017-02-17 19:06:07 */angular.module("ionic").directive("kdPane",function(){return{restrict:"E",link:function(a,b){b.addClass("pane"),b.addClass("kd-pane")}}}),angular.module("credit",[]).directive("downloadPopup",["Platform","$timeout",function(a,b){return{restrict:"E",scope:{},replace:!0,template:'<div ng-show="isShow" ng-click="download()" class="download-popup">                   <a href="" class="close" ng-click="close($event)"></a>                   <img alt="" src="//h5.xianjincard.com/credit/img/download-logo.png"/>                   <div><p>下载即享极速借款<br/>被拒最高赔偿<i>50元</i></p></div>                 </div>',link:function(b,c,d){b.isShow=!a.isApp,b.close=function(a){a.stopPropagation(),b.isShow=!1},b.download=function(){window.location="https://credit.xianjincard.com/download-app.html"}}}}]).directive("popupPassword",["$timeout",function(a){return{restrict:"E",replace:!0,scope:{isShow:"=",isError:"=",sendHandler:"&"},template:'<div class="popup" id="defray" ng-show="isShow">                  <div class="overlay"></div>                  <div class="dialog pay">                    <span class="close" ng-click="close()"></span>                    <h2>请输入交易密码</h2>                    <p class="clearfix">                      <i></i> <i></i> <i></i> <i></i> <i></i> <i></i>                      <input type="tel" value="" autofocus>                    </p>                    <p ng-show="isError" class="error-tips">密码错误</p>                    <a nav-direction="forward" href="#/my/findpaypassword?state=loan">忘记密码?</a>                  </div>                </div>',link:function(b,c,d){b.close=function(){b.isShow=!1},b.$watch("isShow",function(b){b&&a(function(){$("#defray input").focus()},0)}),b.$watch(function(){return c},function(a){$("#defray p").click(function(a){$("#defray input").focus()}),$("#defray input").focus(function(){var a=setInterval(function(){"INPUT"==document.activeElement.nodeName?$("#defray .dialog").css({top:0,marginTop:0}):($("#defray .dialog").attr("style",""),a&&(clearInterval(a),a=null))},500)}),$("#defray input").bind("input",function(a){var c=$(this).val();$("#defray i").removeClass("point"),$("#defray i").slice(0,c.length).addClass("point"),b.isError=!1,b.$apply(),c.length>=6&&($(this).val(c.slice(0,6)),b.sendHandler({password:$(this).val()}))})})}}}]).directive("textScroll",["$timeout",function(a){return{restrict:"E",replace:!0,scope:{items:"=",interval:"="},template:'<ul class="text-scroll"><li ng-repeat="item in items track by $index">{{item}}</li></ul>',link:function(a,b,c){a.$watch("items",function(b){b&&a.items.push(a.items[0])}),a.$watch(function(){return b[0].children[0]},function(c){try{var d=b[0].children.length,e=c.offsetHeight,f=0,g=a.interval||1e3,h=function(){f++,f>=d&&(f=1,b.css("top",0)),$(b).animate({top:-e*f})};setInterval(h,g)}catch(i){}})}}}]).factory("Domain",["$location",function(a){var b=a.$$host,c=/(?:http(?:s)?:\/\/)?(?:www\.)?(.*?)\./,d=/https?:\/\/(?:[^\/]+\.)?([^.\/]+\.(?:com))(?:$|\/)/,e=b.match(c),f={credit:a.$$protocol+"://"+a.$$host+"/credit/web/",api:a.$$protocol+"://"+a.$$host+"/frontend/web/",h5:a.$$protocol+"://"+a.$$host+"/h5/mobile/web/"};return null!==e&&("h5"===e[1]&&(f={credit:a.$$protocol+"://credit.xianjincard.com/",api:a.$$protocol+"://api.xianjincard.com/",h5:a.$$protocol+"://h5.xianjincard.com/"}),"pre-h5"===e[1]&&(f={credit:a.$$protocol+"://pre-credit.xianjincard.com/",api:a.$$protocol+"://pre-api.xianjincard.com/",h5:a.$$protocol+"://pre-h5.xianjincard.com/"}),"192.168.39.214"==b&&(f={credit:a.$$protocol+"://"+a.$$host+"/kdkj/credit/web/",api:a.$$protocol+"://"+a.$$host+"/kdkj/frontend/web/",h5:a.$$protocol+"://"+a.$$host+"/kdkj/h5/mobile/web/"}),"121.42.12.69"==b&&(f={credit:a.$$protocol+"://"+a.$$host+"/koudai/kdkj/credit/web/",api:a.$$protocol+"://"+a.$$host+"/koudai/kdkj/frontend/web/",h5:a.$$protocol+"://"+a.$$host+"/koudai/kdkj/h5/mobile/web/"})),{resolveUrl:function(b){var e=b.match(c);return f[e[1]]?b.replace(d,f[e[1]]):b.replace(/^https?/,a.$$protocol)},domain:f}}]).factory("Platform",["$location",function(a){function b(b){if(void 0!==a.search()[b])return a.seach()[b];b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+b+"=([^&#]*)"),d=c.exec(location.search);return null===d?void 0:decodeURIComponent(d[1].replace(/\+/g," "))}var c=navigator.userAgent,d=c.split("/");return{getParamByName:b,appVersion:d[d.length-1],isApp:c.indexOf("kdxj")!==-1,isAndroid:c.indexOf("Android")>-1||c.indexOf("Adr")>-1,isIos:!!c.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),isWeixin:c.indexOf("MicroMessenger")>-1,isQQ:" qq"==c.match(/\sQQ/i)}}]).factory("Popup",["$ionicPopup",function(a){function b(b,c){a.alert({title:"提示",template:b,okText:"确定",okType:"button-credit"}).then(function(a){"function"==typeof c&&c()})}var c=function(b){a.confirm({title:b.title||"确认",template:b.content,cancelText:"取消",cancelType:"button-credit-gray",okText:"确定",okType:"button-credit"}).then(function(a){"function"==typeof b.callback&&b.callback(a),a?"function"==typeof b.ok&&b.ok():"function"==typeof b.cance&&b.cance()})};return{alert:b,confirm:c}}]).factory("HttpInterceptor",["$q","$injector",function(a,b){var c={responseError:function(b){return a.reject(b)},response:function(c){if(200!==c.status){var d=b.get("Popup"),e=b.get("$ionicLoading");return e.hide(),d.alert("请求不成功"),a.reject(c)}if(void 0!==c.data.code&&c.data.code==-2){var d=b.get("Popup"),e=b.get("$ionicLoading");return e.hide(),d.alert(c.data.message,function(){var a=b.get("$state");a.go("login")}),a.reject(c)}return c},request:function(a){return a},requestError:function(b){return a.reject(b)}};return c}]).filter("isEmpty",function(){var a;return function(b){for(a in b)if(b.hasOwnProperty(a))return!1;return!0}}).filter("trusted",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("invite",["credit","ionic","InviteControllers","InviteFactory"]).run(["$ionicPlatform",function(a){a.ready(function(){window.StatusBar&&StatusBar.styleDefault()})}]).config(["$httpProvider","$compileProvider","$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(a,b,c,d,e){e.tabs.position("bottom"),e.tabs.style("standard"),e.navBar.alignTitle("center"),b.aHrefSanitizationWhitelist(/^\s*(https?|http?|wap2app|schemekdlc|kdlc.app.launch):/),a.defaults.withCredentials=!0,a.interceptors.push("HttpInterceptor"),c.state("home",{url:"/home",templateUrl:"templates/home.html",controller:"InviteHomeController"}).state("share",{url:"/",templateUrl:"templates/share.html",controller:"InviteShareController"}),d.otherwise("/")}]),angular.module("InviteFactory",[]).factory("InviteHomeService",["Domain","$http","Platform","$location",function(a,b,c,d){return{getData:function(){var c=a.resolveUrl("http://credit.xianjincard.com/credit-invite/invite-act");return b.get(c).then(function(a){return a.data})}}}]).factory("InviteShareService",["Domain","$http","Platform","$location","$httpParamSerializerJQLike",function(a,b,c,d,e){return{getData:function(c){var d=a.resolveUrl("http://credit.xianjincard.com/credit-invite/get-user-info?invite_code="+c);return b.get(d).then(function(a){return a.data})},getCode:function(c){var d=a.resolveUrl("http://credit.xianjincard.com/credit-user/reg-get-code");return b({method:"POST",url:d,data:e({phone:c}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},register:function(c,d){var f="inviteThree",g=a.resolveUrl("http://credit.xianjincard.com/credit-user/register?appMarket="+f);return b({method:"POST",url:g,data:e({phone:c.phone,password:c.password,code:c.code,source:21,invite_code:d}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})}}}]),angular.module("InviteControllers",[]).controller("InviteHomeController",["$scope","InviteHomeService","$ionicLoading","$state","Platform","Domain","$interval","$timeout",function(a,b,c,d,e,f,g,h){a.homeData={count:0},a.errorMessage="";var i=0;_hmt.push(["_trackPageview","/activityInvite"]);var j=function(){return"#"+function(a){return new Array(7-a.length).join("0")+a}((16777216*Math.random()<<0).toString(16))},k=function(a){for(var b=[],c={},d=0;d<a.length;d++)c[a[d]]||(b.push(a[d]),c[a[d]]=1);return b},l=function(a){var b=0;$(".mask div").show().each(function(c,d){if(!$(d).is(":animated")){var e=$(".mask").width(),f=$(".mask").height()-$(this).height()/2,g=f/a;b+=g,b>f&&(b=g),$(this).css({left:e*(Math.random()/2+1),top:b-g,color:j()});var h=12500;$(this).index()&&(h=1e3*(Math.round(Math.random())+12)-800*Math.random()),$(this).animate({left:"-"+1.2*e+"px"},h,function(){$(this).remove()})}})},m=function(){c.show({template:"<ion-spinner></ion-spinner>"}),b.getData().then(function(b){c.hide(),i=b.code,q(),1==i?a.homeData=b.data:i==-10?(a.errorMessage="本活动已结束，请关注平台其他活动",$(".popup-error").show()):i==-11?(a.errorMessage="本次邀请活动1月6日0:00开启哦！",$(".popup-error").show()):i==-1?(a.homeData=b.data,void 0==a.homeData.count&&(a.homeData.count=0)):(a.errorFlag=!0,a.errorMessage=b.message||"服务器繁忙，请稍候重试",$(".popup-error").show())})};m();var n=function(a,b,c,d,e){var e=1==e?1:0;return!(void 0==nativeMethod||!nativeMethod)&&nativeMethod.shareMethod('{"share_title":"'+a+'","share_body":"'+b+'","share_url":"'+c+'","share_logo":"'+d+'","type":"'+e+'"}')},o=function(){return function(){var a=+new Date;setTimeout(function(){!window.document.webkitHidden&&setTimeout(function(){+new Date-a<2e3&&(window.location="https://itunes.apple.com/us/app/xian-jin-bai-ka-you-shen-fen/id1156410247?mt=8")},500)},500)}},p=function(){return function(){var a=+new Date;setTimeout(function(){!window.document.webkitHidden&&setTimeout(function(){+new Date-a<2e3&&(window.location="https://credit.xianjincard.com/download-app.html")},500)},500)}};$("#invite").click(function(b){if(!e.isApp)window.location.href="https://api.xianjincard.com/download-app.html";else if(1==i){b.preventDefault();var c="http://h5.xianjincard.com/activity/invite/index.html?invite_code="+a.homeData.invite_code,d=f.resolveUrl(c),g=f.resolveUrl("http://h5.xianjincard.com/activity/invite/img/invite-share-logo.png");n("送你一个新年红包","通过我的邀请注册，1分钟认证，20分钟到账，被拒还有赔偿！",d,g,0)}else i==-1?$(".popup-login").show():i==-10?(a.errorMessage="本活动已结束，请关注平台其他活动",$(".popup-error").show()):i==-11&&(a.errorMessage="本次邀请活动1月6日0:00开启哦！",$(".popup-error").show())}),a.lookAward=function(){if(!e.isApp){var b={versions:function(){var a=navigator.userAgent;navigator.appVersion;return{ios:!!a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:a.indexOf("Android")>-1||a.indexOf("Linux")>-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()};b.versions.ios===!0?(window.location.href="https://itunes.apple.com/app/id1156410247?mt=8",o()):b.versions.android===!0?(window.location.href="xianjincard://com.kdlc.mcc/openapp",p()):window.location.href="https://api.xianjincard.com/download-app.html"}else if(i==-1)$(".popup-lookAward").show();else if(i==-11)a.errorMessage="本次邀请活动1月6日0:00开启哦！",$(".popup-error").show();else{var c=f.resolveUrl("http://credit.xianjincard.com/credit-invite/invite-rebates-apply-cash");window.location.href=c}},a.showRule=function(){$(".popup-rule").show()},a.closeRule=function(){$(".popup-rule").hide()},a.closePop=function(){$(".popup").hide()},a.login=function(){$(".popup").hide(),window.location.href="koudaikj://app.launch/login/applogin"};var q=function(){var b=["老司机，带带我","Word天，邀请这么多","原来我的朋友圈都是土豪，不差钱","呵呵呵呵…………","邀请So easy","我的春节红包谁要帮我邀","邀啊邀，邀到外婆桥","缺钱的有点多","天天领钱，都不想上班了","妈妈再也不用担心我没钱了","先定一个小目标，邀请100个","我不是为了邀请，我是为了缺钱的兄弟","邀or不邀，这不是个问题","看在钱的份上，能不能再多邀一个","我的朋友圈都被我刷屏了","没钱找现金卡借","一卡在手，天下我有","没有人让我邀，蓝瘦香菇","邀请达人快来教教宝宝","我要每天都霸屏","这是我的地盘，看我的","一不小心，邀请的有点多","邀邀邀，切克now","跟我一起说“邀”","原来这个世界这么多人缺钱"],c=["分我点人啊，我快到100了","厉害了我的哥，已经拿到1000元","才邀请就发现已经邀请了5个","朋友圈、QQ群都是我的邀请","微博贴吧全是我的邀请"],d=["恭喜用户158****1261获得108元奖励","恭喜用户138****7261获得238元奖励","恭喜用户170****3821获得68元奖励","恭喜用户151****4587获得88元奖励","恭喜用户137****1654获得108元奖励","恭喜用户159****5481获得128元奖励","恭喜用户150****8544获得88元奖励","恭喜用户189****4215获得68元奖励","恭喜用户158****4212获得48元奖励","恭喜用户139****6481获得68元奖励","恭喜用户171****3216获得48元奖励","恭喜用户180****5697获得88元奖励","恭喜用户159****9254获得68元奖励","恭喜用户139****5461获得68元奖励","恭喜用户158****2651获得48元奖励","恭喜用户188****9874获得68元奖励","恭喜用户186****6623获得48元奖励","恭喜用户138****8567获得48元奖励","恭喜用户139****9422获得48元奖励","恭喜用户158****1315获得88元奖励","恭喜用户151****6548获得68元奖励","恭喜用户158****3165获得48元奖励","恭喜用户181****6541获得68元奖励","恭喜用户188****1876获得88元奖励","恭喜用户150****9112获得88元奖励","恭喜用户188****5913获得48元奖励","恭喜用户189****5915获得68元奖励","恭喜用户138****3481获得108元奖励","恭喜用户159****3226获得48元奖励","恭喜用户151****8971获得48元奖励"],e=[],f=[],g=[],h=[],j=Math.round(4*Math.random())+1,m=30;if(i==-11)f=b;else if(void 0==a.homeData.rand)f=b.concat(d,c);else{for(var n in a.homeData.rand)e.push("恭喜用户"+a.homeData.rand[n].user_phone+"获得"+a.homeData.rand[n].total+"元奖励");f=b.concat(c,e,d.slice(0,m-a.homeData.rand.length-1))}j<3&&(j=4);for(var o=0;o<j;o++){var p=Math.round(Math.random()*(f.length-1));g[o]=f[p]}h=k(g);for(var q in h){var r=$("<div style='top:0px;opacity:1;font-size: 0.4rem'>"+h[q]+"</div>");$(".mask").append(r.show())}l(h.length)};g(q,3e3)}]).controller("InviteShareController",["$scope","InviteShareService","$ionicLoading","$state","Platform","Domain","$timeout","Popup",function(a,b,c,d,e,f,g,h){a.codeText="获取验证码",a.codeFlag=!1,a.shareData={},a.errorMessage="",_hmt.push(["_trackPageview","/activityInviteShare"]),$(".other label i").show();var i=function(){var a=new Object,b=window.location.href,c=b.split("?");if(c[1]){var d=c[1].split("#")[0];if(d.indexOf("?")==-1){var e=decodeURI(d);parameterArray=e.split("&");for(var f=0;f<parameterArray.length;f++)a[parameterArray[f].split("=")[0]]=parameterArray[f].split("=")[1]}}return a},j=i(),k=function(){c.show({template:"<ion-spinner></ion-spinner>"}),b.getData(encodeURIComponent(j.invite_code)).then(function(b){c.hide(),1==b.code?a.shareData=b.data:(a.errorMessage=b.message||"服务器繁忙，请稍候重试",$(".popup-code").show())})};k();var l=function(b,c){g(function(){a.codeText=b+"秒后重试",b?l(--b,1e3):(a.codeText="重新发送",a.sendDisabled=!1)},c)};a.setCode=function(){a.codeFlag=!1},a.getCode=function(d){c.show({template:"<ion-spinner></ion-spinner>"}),b.getCode(d).then(function(b){c.hide(),1e3==b.code?$(".popup-register").show():(a.errorMessage=b.message||"服务器繁忙，请稍候重试",$(".popup-code").show())}),a.sendDisabled=!0,l(60)},a.downloadApp=function(){window.location.href="https://api.xianjincard.com/download-app.html"},a.register=function(d){return $(".other label i").is(":visible")?(c.show({template:"<ion-spinner></ion-spinner>"}),void b.register(d,encodeURIComponent(j.invite_code)).then(function(b){c.hide(),0==b.code?$(".popup-success").show():(a.errorMessage=b.message||"服务器繁忙，请稍候重试",$(".popup-code").show())})):(a.errorMessage="请选择同意《现金白卡使用协议》",void $(".popup-code").show())},a.agreeAgreement=function(){$(".other label i").is(":visible")?$(".other label i").hide():$(".other label i").show()},a.closePop=function(){$(".popup-share").hide()}}]);