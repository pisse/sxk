/* 2017-02-17 19:05:31 */angular.module("ionic").directive("kdPane",function(){return{restrict:"E",link:function(a,b){b.addClass("pane"),b.addClass("kd-pane")}}}),angular.module("credit",[]).directive("downloadPopup",["Platform","$timeout",function(a,b){return{restrict:"E",scope:{},replace:!0,template:'<div ng-show="isShow" ng-click="download()" class="download-popup">                   <a href="" class="close" ng-click="close($event)"></a>                   <img alt="" src="//h5.dahubao.com/credit/img/download-logo.png"/>                   <div><p>下载即享极速借款<br/>被拒最高赔偿<i>50元</i></p></div>                 </div>',link:function(b,c,d){b.isShow=!a.isApp,b.close=function(a){a.stopPropagation(),b.isShow=!1},b.download=function(){window.location="https://credit.dahubao.com/download-app.html"}}}}]).directive("popupPassword",["$timeout",function(a){return{restrict:"E",replace:!0,scope:{isShow:"=",isError:"=",sendHandler:"&"},template:'<div class="popup" id="defray" ng-show="isShow">                  <div class="overlay"></div>                  <div class="dialog pay">                    <span class="close" ng-click="close()"></span>                    <h2>请输入交易密码</h2>                    <p class="clearfix">                      <i></i> <i></i> <i></i> <i></i> <i></i> <i></i>                      <input type="tel" value="" autofocus>                    </p>                    <p ng-show="isError" class="error-tips">密码错误</p>                    <a nav-direction="forward" href="#/my/findpaypassword?state=loan">忘记密码?</a>                  </div>                </div>',link:function(b,c,d){b.close=function(){b.isShow=!1},b.$watch("isShow",function(b){b&&a(function(){$("#defray input").focus()},0)}),b.$watch(function(){return c},function(a){$("#defray p").click(function(a){$("#defray input").focus()}),$("#defray input").focus(function(){var a=setInterval(function(){"INPUT"==document.activeElement.nodeName?$("#defray .dialog").css({top:0,marginTop:0}):($("#defray .dialog").attr("style",""),a&&(clearInterval(a),a=null))},500)}),$("#defray input").bind("input",function(a){var c=$(this).val();$("#defray i").removeClass("point"),$("#defray i").slice(0,c.length).addClass("point"),b.isError=!1,b.$apply(),c.length>=6&&($(this).val(c.slice(0,6)),b.sendHandler({password:$(this).val()}))})})}}}]).directive("textScroll",["$timeout",function(a){return{restrict:"E",replace:!0,scope:{items:"=",interval:"="},template:'<ul class="text-scroll"><li ng-repeat="item in items track by $index">{{item}}</li></ul>',link:function(a,b,c){a.$watch("items",function(b){b&&a.items.push(a.items[0])}),a.$watch(function(){return b[0].children[0]},function(c){try{var d=b[0].children.length,e=c.offsetHeight,f=0,g=a.interval||1e3,h=function(){f++,f>=d&&(f=1,b.css("top",0)),$(b).animate({top:-e*f})};setInterval(h,g)}catch(i){}})}}}]).factory("Domain",["$location",function(a){var b=a.$$host,c=/(?:http(?:s)?:\/\/)?(?:www\.)?(.*?)\./,d=/https?:\/\/(?:[^\/]+\.)?([^.\/]+\.(?:com))(?:$|\/)/,e=b.match(c),f={credit:a.$$protocol+"://"+a.$$host+"/credit/web/",api:a.$$protocol+"://"+a.$$host+"/frontend/web/",h5:a.$$protocol+"://"+a.$$host+"/h5/mobile/web/"};return null!==e&&("h5"===e[1]&&(f={credit:a.$$protocol+"://credit.dahubao.com/",api:a.$$protocol+"://api.dahubao.com/",h5:a.$$protocol+"://h5.dahubao.com/"}),"pre-h5"===e[1]&&(f={credit:a.$$protocol+"://pre-credit.dahubao.com/",api:a.$$protocol+"://pre-api.dahubao.com/",h5:a.$$protocol+"://pre-h5.dahubao.com/"}),"192.168.39.214"==b&&(f={credit:a.$$protocol+"://"+a.$$host+"/kdkj/credit/web/",api:a.$$protocol+"://"+a.$$host+"/kdkj/frontend/web/",h5:a.$$protocol+"://"+a.$$host+"/kdkj/h5/mobile/web/"}),"121.42.12.69"==b&&(f={credit:a.$$protocol+"://"+a.$$host+"/koudai/kdkj/credit/web/",api:a.$$protocol+"://"+a.$$host+"/koudai/kdkj/frontend/web/",h5:a.$$protocol+"://"+a.$$host+"/koudai/kdkj/h5/mobile/web/"})),{resolveUrl:function(b){var e=b.match(c);return f[e[1]]?b.replace(d,f[e[1]]):b.replace(/^https?/,a.$$protocol)},domain:f}}]).factory("Platform",["$location",function(a){function b(b){if(void 0!==a.search()[b])return a.seach()[b];b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+b+"=([^&#]*)"),d=c.exec(location.search);return null===d?void 0:decodeURIComponent(d[1].replace(/\+/g," "))}var c=navigator.userAgent,d=c.split("/");return{getParamByName:b,appVersion:d[d.length-1],isApp:c.indexOf("kdxj")!==-1,isAndroid:c.indexOf("Android")>-1||c.indexOf("Adr")>-1,isIos:!!c.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),isWeixin:c.indexOf("MicroMessenger")>-1,isQQ:" qq"==c.match(/\sQQ/i)}}]).factory("Popup",["$ionicPopup",function(a){function b(b,c){a.alert({title:"提示",template:b,okText:"确定",okType:"button-credit"}).then(function(a){"function"==typeof c&&c()})}var c=function(b){a.confirm({title:b.title||"确认",template:b.content,cancelText:"取消",cancelType:"button-credit-gray",okText:"确定",okType:"button-credit"}).then(function(a){"function"==typeof b.callback&&b.callback(a),a?"function"==typeof b.ok&&b.ok():"function"==typeof b.cance&&b.cance()})};return{alert:b,confirm:c}}]).factory("HttpInterceptor",["$q","$injector",function(a,b){var c={responseError:function(b){return a.reject(b)},response:function(c){if(200!==c.status){var d=b.get("Popup"),e=b.get("$ionicLoading");return e.hide(),d.alert("请求不成功"),a.reject(c)}if(void 0!==c.data.code&&c.data.code==-2){var d=b.get("Popup"),e=b.get("$ionicLoading");return e.hide(),d.alert(c.data.message,function(){var a=b.get("$state");a.go("login")}),a.reject(c)}return c},request:function(a){return a},requestError:function(b){return a.reject(b)}};return c}]).filter("isEmpty",function(){var a;return function(b){for(a in b)if(b.hasOwnProperty(a))return!1;return!0}}).filter("trusted",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("crossYear",["credit","ionic","CrossYearControllers","CrossYearFactory"]).run(["$ionicPlatform",function(a){a.ready(function(){window.StatusBar&&StatusBar.styleDefault()})}]).config(["$httpProvider","$compileProvider","$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(a,b,c,d,e){e.tabs.position("bottom"),e.tabs.style("standard"),e.navBar.alignTitle("center"),b.aHrefSanitizationWhitelist(/^\s*(https?|http?|wap2app|schemekdlc|kdlc.app.launch):/),a.defaults.withCredentials=!0,a.interceptors.push("HttpInterceptor"),c.state("team",{url:"/",templateUrl:"templates/team.html",controller:"TeamController"}),d.otherwise("/")}]),angular.module("CrossYearFactory",[]).factory("TeamService",["Domain","$http","Platform","$location","$httpParamSerializerJQLike",function(a,b,c,d,e){return{getData:function(c){var d=a.resolveUrl("http://credit.dahubao.com/jigsaw-puzzle/puzzle?sign="+c);return b.get(d).then(function(a){return a.data})},getCode:function(c){var d=a.resolveUrl("http://credit.dahubao.com/credit-user/send-invite-code");return b({method:"POST",url:d,data:e({phone:c}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},reRegister:function(c,d){var f="jigsaw",g=a.resolveUrl("http://credit.dahubao.com/jigsaw-puzzle/re-register?appMarket="+f);return b({method:"POST",url:g,data:e({phone:c,code:d}),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},luckDraw:function(c){var d=a.resolveUrl("http://credit.dahubao.com/jigsaw-puzzle/puzzle?sign="+c);return b({method:"POST",url:d,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},createJigsaw:function(){var c=a.resolveUrl("http://credit.dahubao.com/jigsaw-puzzle/create-jigsaw");return b({method:"POST",url:c,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})}}}]),angular.module("CrossYearControllers",[]).controller("TeamController",["$scope","TeamService","$ionicLoading","$state","$timeout","$interval","Popup","Domain",function(a,b,c,d,e,f,g,h){function i(a){var b=new Object,c=window.location.href,d=c.split("?");if(d[1]){var e=d[1].split("#")[0];if(e.indexOf("?")==-1){var f=decodeURI(e);parameterArray=f.split("&");for(var g=0;g<parameterArray.length;g++)b[parameterArray[g].split("=")[0]]=parameterArray[g].split("=")[1]}}return b}a.firstJigsaw=!0,a.diglogFlag=1,a.codeText="获取验证码",a.sendDisabled=!1,a.codeFlag=!1,a.callFriend=!1,a.binding=!0,a.imageFlag=!1,a.teamData={},a.jigData={name:"XXXX"},a.prizeData={},a.timeHours="00",a.timeMins="00",a.timeSecs="00",a.finalHours="00",a.finalMins="00",a.finalSecs="00",a.sumPeople=0,a.sumJigsaw=4;var j=1;a.sign=i(),a.jigsaw={one:"",two:"",three:"",four:""};var k=function(a,b){e(function(){var b=1e3*a;l(b),a+=1,k(a,1e3)},b)},l=function(b){a.timeHours=parseInt(b/1e3/3600)+"";var c=b-1e3*a.timeHours*3600;a.timeMins=parseInt(c/6e4)+"",a.timeSecs=parseInt(c%6e4/1e3)+"",1==a.timeHours.length&&(a.timeHours="0"+a.timeHours),1==a.timeMins.length&&(a.timeMins="0"+a.timeMins),1==a.timeSecs.length&&(a.timeSecs="0"+a.timeSecs)},m=function(b){for(var c in b)1==b[c]&&(a.jigsaw.one="1"),2==b[c]&&(a.jigsaw.two="2"),3==b[c]&&(a.jigsaw.three="3"),4==b[c]&&(a.jigsaw.four="4")},n=function(){1==j&&c.show({template:"<ion-spinner></ion-spinner>"}),b.getData(a.sign.sign).then(function(b){if(1==j&&c.hide(),a.teamData=b,1==a.teamData.code)a.sumJigsaw=4,a.jigData=b.data.jig_data,""==a.jigData.img||null==a.jigData.img?a.imageFlag=!1:a.imageFlag=!0,0!=a.jigData.use_time&&0==a.jigData.total_time?k(a.jigData.use_time):0!=a.jigData.total_time&&l(1e3*a.jigData.total_time),1==a.teamData.data.is_own?a.callFriend=!0:a.callFriend=!1,a.sumPeople=a.teamData.data.lists.length,a.sumJigsaw=a.sumJigsaw-a.teamData.data.pics.length,m(a.teamData.data.pics),0==a.sumJigsaw&&($(".card-overlay").css("display","none"),$(".jigsawComplete").css("display","block"),$(".help").css("visibility","hidden"),$(".jigsawComplete").addClass("jigsawCompleteAnimation"),a.finalHours=a.timeHours,a.finalMins=a.timeMins,a.finalSecs=a.timeSecs),1==j&&(a.teamData.data.validate.code==-10?(a.errorMessage="本活动已结束，请关注平台其他活动",a.firstJigsaw=!1,a.diglogFlag=6,$(".popup-message").css("display","block")):a.teamData.data.validate.code==-11&&(a.errorMessage="活动12月28日开启，敬请期待",a.firstJigsaw=!1,a.diglogFlag=6,$(".popup-message").css("display","block")),j=2);else if(a.teamData.code==-1){var d="http://h5.dahubao.com/activity/cross-year-two/index.html?sign="+a.sign.sign,e=h.resolveUrl(d),f="http://credit.dahubao.com/wx/user-auth-template?redirectUrl="+e,g=h.resolveUrl(f);window.location.href=g,j=2}else a.firstJigsaw=!1,a.diglogFlag=6,a.errorMessage=b.message||"服务器繁忙，请稍候重试",j=2,$(".popup-message").css("display","block")})};n(),f(function(){n()},2e4);var o=function(b,c){e(function(){a.codeText=b+"秒后重试",b?o(--b,1e3):(a.codeText="重新发送",a.sendDisabled=!1)},c)};a.showRule=function(){var a="http://h5.dahubao.com/activity/cross-year/index.html",b=h.resolveUrl(a);window.location.href=b},a.closePop=function(){$(".popup").css("display","none")},a.startJigsaw=function(){a.firstJigsaw=!0,c.show({template:"<ion-spinner></ion-spinner>"}),b.createJigsaw().then(function(b){if(c.hide(),1==b.code)if(b.data.validate.code==-10)a.errorMessage="本活动已结束，请关注平台其他活动",a.firstJigsaw=!1,a.diglogFlag=6,$(".popup-message").css("display","block");else if(b.data.validate.code==-11)a.errorMessage="活动12月28日开启，敬请期待",a.firstJigsaw=!1,a.diglogFlag=6,$(".popup-message").css("display","block");else{var d="http://h5.dahubao.com/activity/cross-year-two/index.html?sign="+b.data.sign,e=h.resolveUrl(d);window.location.href=e}else b.code==-1?(a.binding=!1,$(".popup-message").css("display","block")):(a.firstJigsaw=!1,a.diglogFlag=6,a.errorMessage=b.message||"服务器繁忙，请稍候重试",$(".popup-message").css("display","block"))})},a.bindingWx=function(d){c.show({template:"<ion-spinner></ion-spinner>"}),b.reRegister(d.phone,d.code).then(function(b){c.hide(),1==b.code?(a.firstJigsaw=!1,a.diglogFlag=5,$(".popup-message").css("display","block")):b.code==-1?a.codeFlag=!0:(a.firstJigsaw=!1,a.diglogFlag=6,a.errorMessage=b.message||"服务器繁忙，请稍候重试",$(".popup-message").css("display","block"))})},a.callHelp=function(){var b=a.teamData.data.validate.code;1==b?$(".popup-share").css("display","block"):b==-10?(a.errorMessage="本活动已结束，请关注平台其他活动",a.firstJigsaw=!1,a.diglogFlag=6,$(".popup-message").css("display","block")):(a.errorMessage="活动12月28日开启，敬请期待",a.firstJigsaw=!1,a.diglogFlag=6,$(".popup-message").css("display","block"))},a.drawCard=function(){a.binding=!0;var d=a.teamData.data.wx_info,e=a.teamData.data.validate.code;1==e?""!=d.phone||0!=d.uid?(c.show({template:"<ion-spinner></ion-spinner>"}),b.luckDraw(a.sign.sign).then(function(b){c.hide(),a.firstJigsaw=!1,1==b.code?("0"!=b.data.amount?(a.diglogFlag=1,a.prizeData.pic=b.data.pic,a.prizeData.amount=b.data.amount,n()):(a.diglogFlag=3,a.prizeData.pic=b.data.pic,n()),$(".popup-message").css("display","block")):2==b.code?($(".popup-message").css("display","block"),a.diglogFlag=2):b.code==-22?($(".popup-message").css("display","block"),a.diglogFlag=4):(a.diglogFlag=6,a.errorMessage=b.message||"服务器繁忙，请稍候重试",$(".popup-message").css("display","block"))})):(a.firstJigsaw=!0,$(".popup-message").css("display","block")):e==-10?(a.errorMessage="本活动已结束，请关注平台其他活动",a.firstJigsaw=!1,a.diglogFlag=6,$(".popup-message").css("display","block")):(a.errorMessage="活动12月28日开启，敬请期待",a.firstJigsaw=!1,a.diglogFlag=6,$(".popup-message").css("display","block"))},a.receiveRed=function(d){c.show({template:"<ion-spinner></ion-spinner>"}),b.reRegister(d.phone,d.code).then(function(d){a.register=d,1==a.register.code?b.luckDraw(a.sign.sign).then(function(b){c.hide(),a.firstJigsaw=!1,$(".popup-message").css("display","none"),1==b.code?("0"!=b.data.amount?(a.diglogFlag=1,a.prizeData.pic=b.data.pic,a.prizeData.amount=b.data.amount,n()):(a.diglogFlag=3,a.prizeData.pic=b.data.pic,n()),$(".popup-message").css("display","block")):2==b.code?($(".popup-message").css("display","block"),a.diglogFlag=2):b.code==-22?($(".popup-message").css("display","block"),a.diglogFlag=4):(a.diglogFlag=6,a.errorMessage=b.message||"服务器繁忙，请稍候重试",$(".popup-message").css("display","block"))}):a.register.code==-1?(c.hide(),a.firstJigsaw=!0,a.codeFlag=!0):(c.hide(),a.firstJigsaw=!1,a.diglogFlag=6,a.errorMessage=d.message||"服务器繁忙，请稍候重试",$(".popup-message").css("display","block"))})},a.lookDrawRed=function(){+new Date;window.location.href="https://api.dahubao.com/download-app.html"},a.setCode=function(){a.codeFlag=!1},a.getCode=function(d){c.show({template:"<ion-spinner></ion-spinner>"}),b.getCode(d).then(function(b){c.hide(),0==b.code?(a.sendDisabled=!0,o(60)):g.alert(b.message)})}}]);