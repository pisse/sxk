/* 2017-11-01 23:28:36 */angular.module("ionic").directive("kdPane",function(){return{restrict:"E",link:function(a,b){b.addClass("pane"),b.addClass("kd-pane")}}}),angular.module("credit",[]).directive("downloadPopup",["Platform","$timeout",function(a,b){return{restrict:"E",scope:{},replace:!0,template:'<div ng-show="isShow" ng-click="download()" class="download-popup">                   <a href="" class="close" ng-click="close($event)"></a>                   <img alt="" src="//h5.xianjincard.com/credit/img/download-logo.png"/>                   <div><p>下载即享极速借款<br/>被拒最高赔偿<i>50元</i></p></div>                 </div>',link:function(b,c,d){b.isShow=!a.isApp,b.close=function(a){a.stopPropagation(),b.isShow=!1},b.download=function(){window.location="https://credit.xianjincard.com/download-app.html"}}}}]).directive("popupPassword",["$timeout",function(a){return{restrict:"E",replace:!0,scope:{title:"=",isHref:"=",isShow:"=",isError:"=",sendHandler:"&"},template:'<div class="popup" id="defray" ng-show="isShow">                  <div class="overlay"></div>                  <div class="dialog pay">                    <span class="close" ng-click="close()"></span>                    <h2>{{title}}</h2>                    <p class="clearfix">                      <i></i> <i></i> <i></i> <i></i> <i></i> <i></i>                      <input type="tel" value="" autofocus>                    </p>                    <p ng-show="isError" class="error-tips">密码错误</p>                    <a ng-show="isHref" nav-direction="forward" href="#/my/findpaypassword?state=loan">忘记密码?</a>                  </div>                </div>',link:function(b,c,d){b.close=function(){b.isShow=!1},b.$watch("isShow",function(c){c&&a(function(){b.isError=!1,$("#defray .error-tips").text("密码错误"),$("#defray input").val(""),$("#defray i").removeClass("point"),$("#defray input").focus()},0)}),b.$watch(function(){return c},function(a){$("#defray div.overlay").click(function(a){a.stopPropagation(),$("#defray input").blur()});$("#defray p").click(function(a){$("#defray input").focus()}),$("#defray input").focus(function(){var a=setInterval(function(){if("INPUT"==document.activeElement.nodeName){var b=$("#defray .dialog").position.top;if(b<=0)return;document.body.scrollTop=0,$("#defray .dialog").animate({top:0,marginTop:0},100)}else $("#defray .dialog").attr("style",""),a&&(clearInterval(a),a=null)},200)}),$("#defray input").bind("input",function(a){var c=$(this).val();$("#defray i").removeClass("point"),$("#defray i").slice(0,c.length).addClass("point"),b.isError=!1,b.$apply(),c.length>=6&&($(this).val(c.slice(0,6)),b.sendHandler({password:$(this).val()}))})})}}}]).directive("textScroll",["$timeout",function(a){return{restrict:"E",replace:!0,scope:{items:"=",interval:"="},template:'<ul class="text-scroll"><li ng-repeat="item in items track by $index">{{item}}</li></ul>',link:function(a,b,c){a.$watch("items",function(b){b&&a.items.push(a.items[0])}),a.$watch(function(){return b[0].children[0]},function(c){try{var d=b[0].children.length,e=c.offsetHeight,f=0,g=a.interval||1e3,h=function(){f++,f>=d&&(f=1,b.css("top",0)),$(b).animate({top:-e*f})};setInterval(h,g)}catch(i){}})}}}]).factory("Domain",["$location",function(a){var b=a.$$host,c=/(?:http(?:s)?:\/\/)?(?:www\.)?(.*?)\./,d=/https?:\/\/(?:[^\/]+\.)?([^.\/]+\.(?:com))(?:$|\/)/,e=b.match(c),f={credit:a.$$protocol+"://"+a.$$host+"/credit/web/",api:a.$$protocol+"://"+a.$$host+"/frontend/web/",h5:a.$$protocol+"://"+a.$$host+"/h5/mobile/web/",h:a.$$protocol+"://"+a.$$host+":8000/"};return null!==e&&("h5"===e[1]&&(f={credit:a.$$protocol+"://credit.xianjincard.com/",api:a.$$protocol+"://api.xianjincard.com/",h5:a.$$protocol+"://h5.xianjincard.com/",h:a.$$protocol+"://h.xianjincard.com/"}),"pre-h5"===e[1]&&(f={credit:a.$$protocol+"://pre-credit.xianjincard.com/",api:a.$$protocol+"://pre-api.xianjincard.com/",h5:a.$$protocol+"://pre-h5.xianjincard.com/",h:a.$$protocol+"://pre-h.xianjincard.com/"}),"test-h5"===e[1]&&(f={credit:a.$$protocol+"://test-credit.xianjincard.com/",api:a.$$protocol+"://test-api.xianjincard.com/",h5:a.$$protocol+"://test-h5.xianjincard.com/",h:a.$$protocol+"://test-h.xianjincard.com/"}),"192.168.39.214"==b&&(f={credit:a.$$protocol+"://"+a.$$host+"/kdkj/credit/web/",api:a.$$protocol+"://"+a.$$host+"/kdkj/frontend/web/",h5:a.$$protocol+"://"+a.$$host+"/kdkj/h5/mobile/web/"}),"121.42.12.69"==b&&(f={credit:a.$$protocol+"://"+a.$$host+"/koudai/kdkj/credit/web/",api:a.$$protocol+"://"+a.$$host+"/koudai/kdkj/frontend/web/",h5:a.$$protocol+"://"+a.$$host+"/koudai/kdkj/h5/mobile/web/"})),{resolveUrl:function(b){var e=b.match(c);return f[e[1]]?b.replace(d,f[e[1]]):b.replace(/^https?/,a.$$protocol)},domain:f}}]).factory("Platform",["$location",function(a){function b(b){if(void 0!==a.search()[b])return a.seach()[b];b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+b+"=([^&#]*)"),d=c.exec(location.search);return null===d?void 0:decodeURIComponent(d[1].replace(/\+/g," "))}var c=navigator.userAgent,d=c.split("/");return{getParamByName:b,appVersion:d[d.length-1],isApp:c.indexOf("kdxj")!==-1,isAndroid:c.indexOf("Android")>-1||c.indexOf("Adr")>-1,isIos:!!c.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),isWeixin:c.indexOf("MicroMessenger")>-1,isQQ:" qq"==c.match(/\sQQ/i)}}]).factory("Popup",["$ionicPopup",function(a){function b(b,c){a.alert({title:"提示",template:b,okText:"确定",okType:"button-credit"}).then(function(a){"function"==typeof c&&c()})}var c=function(b){a.confirm({title:b.title||"确认",template:b.content,cancelText:"取消",cancelType:"button-credit-gray",okText:"确定",okType:"button-credit"}).then(function(a){"function"==typeof b.callback&&b.callback(a),a?"function"==typeof b.ok&&b.ok():"function"==typeof b.cance&&b.cance()})};return{alert:b,confirm:c}}]).factory("HttpInterceptor",["$q","$injector",function(a,b){var c={responseError:function(b){return a.reject(b)},response:function(c){if(200!==c.status){var d=b.get("Popup"),e=b.get("$ionicLoading");return e.hide(),d.alert("请求不成功"),a.reject(c)}if(void 0!==c.data.code&&c.data.code==-2){var d=b.get("Popup"),e=b.get("$ionicLoading");return e.hide(),d.alert(c.data.message,function(){var a=b.get("$state");a.go("login")}),a.reject(c)}return c},request:function(a){return!/\.html/.test(a.url),a},requestError:function(b){return a.reject(b)}};return c}]).filter("isEmpty",function(){var a;return function(b){for(a in b)if(b.hasOwnProperty(a))return!1;return!0}}).filter("trusted",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]),angular.module("mobile",["credit","rzModule","ionic","mobileControllers","mobileFactory","ionicPicker","radialIndicator","ngFileUpload"]).run(["$ionicPlatform","$rootScope",function(a,b){a.ready(function(){window.StatusBar&&StatusBar.styleDefault()}),b.$on("$stateChangeStart",function(){var a=document.querySelector(".picker-tools-button.cancel-button");a&&a.click()})}]).config(["$locationProvider","$httpProvider","$compileProvider","$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(a,b,c,d,e,f){f.tabs.position("bottom"),f.tabs.style("standard"),f.navBar.alignTitle("center"),c.aHrefSanitizationWhitelist(/^\s*(https?|http?|wap2app|schemekdlc|kdlc.app.launch):/),b.defaults.withCredentials=!0,b.interceptors.push("HttpInterceptor"),d.state("test",{url:"/test",templateUrl:"templates/test.html",controller:"TestController"}).state("login",{url:"/login",templateUrl:"templates/login.html",controller:"LoginController"}).state("login-next",{url:"/login-next",templateUrl:"templates/login-next.html",controller:"LoginNextController",params:{phone:null,redirectUrl:null,appMarket:null,invite_code:null}}).state("reset-password",{url:"/reset-password",templateUrl:"templates/reset-password.html",controller:"ResetPasswordController",params:{phone:null,codeImg:null,redirectUrl:null,isRegister:!1,appMarket:null,invite_code:null}}).state("loan",{url:"/loan",cache:!1,templateUrl:"templates/loan.html",controller:"LoanController",params:{money:null,period:null,item:null,card_type:1,source:!1}}).state("tab",{url:"","abstract":!0,templateUrl:"templates/tabs.html",controller:"TabController"}).state("tab.home",{url:"/",views:{"tab-view":{templateUrl:"templates/home.html",controller:"HomeController"}}}).state("tab.repayment",{url:"/repayment",views:{"tab-view":{templateUrl:"templates/repayment.html",controller:"RepaymentController"}}}).state("tab.my",{url:"/my",views:{"tab-view":{templateUrl:"templates/my.html",controller:"MyController"}}}).state("orders",{url:"/my/orders",templateUrl:"templates/my/orders.html",controller:"ordersController"}).state("certification",{url:"/my/certification",templateUrl:"templates/my/certification.html",controller:"CertificationController",params:{origin:null}}).state("information",{url:"/my/certification/information",templateUrl:"templates/my/information.html",controller:"InformationController",params:{position:"",address:"",lng:"",lat:""}}).state("contacts",{url:"/my/certification/contacts",templateUrl:"templates/my/contacts.html",controller:"ContactsController"}).state("position",{url:"/my/certification/information/position",templateUrl:"templates/my/position.html",controller:"PositionController"}).state("paypassword",{url:"/my/paypassword",templateUrl:"templates/my/paypassword.html",controller:"PayPasswordController",params:{state:""}}).state("findpaypassword",{url:"/my/findpaypassword",templateUrl:"templates/my/findpaypassword.html",controller:"FindPayPasswordController",params:{state:""}}).state("setpaypassword",{url:"/my/setpaypassword",templateUrl:"templates/my/setpaypassword.html",controller:"SetPayPasswordController",params:{state:"",phone:"",code:""}}).state("zhimaVerify",{url:"/my/certification/zhima-verify",templateUrl:"templates/my/zhima-verify.html",controller:"zhimaVerifyController"}).state("zhima",{url:"/my/certification/zhima",templateUrl:"templates/my/zhima.html"}).state("findwechat",{url:"/findwechat",templateUrl:"templates/findwechat.html"}),e.otherwise("/")}]),angular.module("mobileControllers",[]).controller("TabController",["Domain",function(a){location.href=a.resolveUrl("https://h.xianjincard.com/mobile")}]).controller("HomeController",["$ionicSlideBoxDelegate","$ionicPopup","Popup","$ionicViewSwitcher","$state","$ionicScrollDelegate","$rootScope","$location","Platform","Domain","$scope","$ionicLoading","$timeout","$ionicSlideBoxDelegate","Popup","MobileService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,a,c,n){g.currentPage="current-home-page",k.pullingTips="科技让金融更简单",k.cIndex=0,k.dIndex=0,n.homeVdsStatistics().then(function(a){if(0==a.code){if(window._vds)return void window._vds.push(["setCS1","inviteCode",a.data.invite_code]);var b=b||[];window._vds=b,function(){b.push(["setAccountId","8fd2500ba4956d6d"]),b.push(["enableHT",!0]),b.push(["setCS1","inviteCode",a.data.invite_code]),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"==document.location.protocol?"https://":"http://")+"dn-growing.qbox.me/vds.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}()}()}}),!g.awaken&&i.isIos&&(g.awaken=!0,window.location.href=i.isAndroid?"xianjincard://com.kdlc.mcc/openapp":"xjbk915164674://"),i.isWeixin&&n.bindWechat().then(function(a){if(a.code==-1001)return void(window.location.href=j.resolveUrl("http://credit.xianjincard.com/wx/user-auth-template?redirectUrl="+window.location.href))}),k.onKnow=function(a){l.show({template:"<ion-spinner></ion-spinner>"}),n.confirmKnow({id:a.id}).then(function(b){l.hide(),0===b.code?location.href=a.active_url:c.alert(b.message)})},k.showTips=function(){b.alert({template:"综合费用=借款利息+居间服务费+信息认证费，综合费用将在借款时一次性扣除",okText:"我知道了",okType:"button-credit"})},k.apply=function(a){if(d.nextDirection("forward"),_hmt.push(["_trackEvent","m版首页","点击马上申请"]),0===a.verify_loan_pass)return void e.go("certification",{origin:"home"});l.show({template:"<ion-spinner></ion-spinner>"});var b=a.amount_days.days[k.dIndex],f={period:b,money:k.sliderAmount.value,card_type:a.card_type};n.getConfirmLoan(f).then(function(a){return l.hide(),0!==a.code?void c.alert(a.message):void(0===a.code&&(f.item=a.data.item,e.go("loan",f)))})};var o=function(){var a=k.data.item.card[k.cIndex].amount_days.interests[k.dIndex],b=k.data.item.card[k.cIndex].amount_days.amounts.length,c=k.data.item.card[k.cIndex].amount_days.amounts[b-1],d=a/c;k.cost=k.sliderAmount.value*d,k.amount=k.sliderAmount.value-k.cost};k.sliderAmount={value:1e3,options:{floor:200,step:100,showSelectionBar:!0,translate:function(a){return a+"元"},onChange:o}};var p=function(a){var b=k.data.item.card[k.cIndex].amount_days.amounts;k.sliderAmount.options.floor=b[0]/100,a||(k.sliderAmount.value=b[b.length-1]/100),o()};k.slideHasChanged=function(a){console.log(a),k.cIndex=a,p()},k.switchDay=function(a){k.dIndex=a,p(!0)};var q=function(b){return 0!=b.code?void c.alert(b.message):(k.data=b.data,a.update(),void p())};l.show({template:"<ion-spinner></ion-spinner>"}),n.getHomeData().then(function(a){l.hide(),q(a)}),k.doRefresh=function(){n.getHomeData().then(function(a){q(a),k.$broadcast("scroll.refreshComplete")})}}]).controller("LoanController",["$window","Platform","$timeout","$location","$stateParams","Popup","$rootScope","$scope","MobileService","$ionicLoading","$ionicViewSwitcher","$state",function(a,b,c,d,e,f,g,h,i,j,k,l){if(!e.money){if(!a.localStorage.getItem("money"))return k.nextDirection("forward"),void l.go("tab.home");e.money=a.localStorage.getItem("money"),e.period=a.localStorage.getItem("period"),e.card_type=a.localStorage.getItem("card_type"),e.item=JSON.parse(a.localStorage.getItem("item")),a.localStorage.removeItem("money"),a.localStorage.removeItem("period"),a.localStorage.removeItem("item"),a.localStorage.removeItem("card_type")}h.item=e.item,h.item.tips=h.item.tips.replace(/(\d+\.?\d+)/g,"<b>$1</b>"),h.isAgress=!0,h.isHref=1===h.item.real_pay_pwd_status,h.passwordTitle=1===h.item.real_pay_pwd_status?"请输入交易密码":"请设置交易密码",h.onAgree=function(){h.isAgress=!h.isAgress},h.onHref=function(b){b.stopPropagation(),a.localStorage.setItem("money",e.money),a.localStorage.setItem("period",e.period),a.localStorage.setItem("card_type",e.card_type),a.localStorage.setItem("item",JSON.stringify(e.item)),location.href=h.item.protocol_url},h.isPicker=!1,h.ticket="不使用券",h.selectIndex=-1,h.showPicker=function(){h.item.coupon_total<=0||(h.isPicker=!0,h.pickerAction="picker-ticket-action")},h.closePicker=function(){c(function(){h.isPicker=!1},300),h.pickerAction=""},h.notPicker=function(){h.ticket="不使用券",h.selectedTicketClass="",h.closePicker(),h.selectIndex=-1,m()};var m=function(){j.show({template:"<ion-spinner></ion-spinner>"});var a={period:e.period,money:e.money,card_type:e.card_type};h.selectIndex>=0&&h.selectIndex<h.item.coupon_list.length&&(a.coupon_id=h.item.coupon_list[h.selectIndex].coupon_id),i.getConfirmLoan(a).then(function(a){return j.hide(),0!==a.code?void f.alert(a.message):void(0===a.code&&(h.item=a.data.item,h.item.tips=h.item.tips.replace(/(\d+\.?\d+)/g,"<b>$1</b>"),h.selectIndex!==-1&&(h.selectIndex=0,h.ticket=h.item.coupon_list[0].str_amount)))})};h.selectPicker=function(a,b){h.selectIndex=b,h.closePicker(),h.ticket=a.str_amount,h.selectedTicketClass="selected-ticket-class",m()},h.confirm=function(){h.isShow=!0};var n=null,o=function(a){return"请设置交易密码"===h.passwordTitle?void c(function(){n=a,h.passwordTitle="请确认交易密码",$("#defray input").val(""),$("#defray i").removeClass("point")},0):a!==n?($("#defray .error-tips").text("两次输入交易密码不同，请重新输入"),void c(function(){h.error=!0},0)):(j.show({template:"<ion-spinner></ion-spinner>"}),void i.setPayPassword({password:a}).then(function(a){return j.hide(),a.code==-1?void f.alert(a.message):(h.isHref=!0,h.passwordTitle="请输入交易密码",h.isShow=!1,f.alert("交易密码设置成功",function(){h.isShow=!0}),void 0)}))},p=function(a){j.show({template:"<ion-spinner></ion-spinner>"});var c={period:e.period,money:h.item.money,card_type:e.card_type};c.pay_password=a,c.order_other=2,h.selectIndex>=0&&h.selectIndex<h.item.coupon_list.length&&(c.coupon_id=h.item.coupon_list[0].coupon_id),i.applyLoan(c).then(function(a){return j.hide(),3===a.code?void(h.error=!0):2===a.code?void f.alert(a.message,function(){l.go("paypassword",{state:"loan"})}):void(0===a.code&&(b.isWeixin?l.go("tab.home"):(l.go("findwechat"),d.replace())))})};h.applyLoan=function(a){h.isHref?p(a):o(a)}}]).controller("zhimaVerifyController",["Popup","$location","$state","$scope","$ionicLoading",function(a,b,c,d,e){var f=b.$$search;/^(https?:\/\/)/.test(f.url)?window.location.href=f.url:a.alert("亲，请先填写个人信息哦~",function(){if(navigator.userAgent.indexOf("kdkj")>=0)return void(window.nativeMethod&&window.nativeMethod.returnNativeMethod('{"type" : "0"}'))})}]).controller("RepaymentController",["$state","$rootScope","$scope","MobileService","$ionicLoading",function(a,b,c,d,e){b.currentPage="current-repayment-page";var f=function(a){0===a.code&&(c.item=a.data.item)};e.show({template:"<ion-spinner></ion-spinner>"}),d.getMyLoan().then(function(a){e.hide(),c.$broadcast("scroll.refreshComplete"),f(a)}),c.doRefresh=function(){d.getMyLoan().then(function(a){c.$broadcast("scroll.refreshComplete"),f(a)})}}]).controller("MyController",["$rootScope","$scope","$location","Popup","$ionicLoading","$ionicViewSwitcher","$state","radialIndicatorInstance","MobileService",function(a,b,c,d,e,f,g,h,i){a.currentPage="current-my-page",b.verify=function(a){if(b.verify_info&&0===b.verify_info.real_verify_status)return a.preventDefault(),void d.alert("亲，请先填写个人信息哦~",function(){f.nextDirection("forward"),g.go("certification")})},b.credit_info={card_amount:0,card_unused_amount:0},b.indicatorOption={displayNumber:!1,barColor:"#4ab6fa",barWidth:64,initValue:0,percentage:!0,frameTime:3,radius:205},b.logout=function(){d.confirm({title:"<br/>您确定要退出登录嘛？",ok:function(){i.logout().then(function(a){return 0!=a.code?void d.alert(a.message):(g.go("login"),void c.replace())})}})},b.doRefresh=function(){e.show({template:"<ion-spinner></ion-spinner>"}),i.getMyInfo().then(function(a){if(e.hide(),0!=a.code)return void d.alert(a.message);for(var c in a.data.item)b[c]=a.data.item[c];b.card_info&&(b.card_info.format=b.card_info.bank_name+"("+b.card_info.card_no_end+")"),h.amount.animate(b.credit_info.card_unused_amount/b.credit_info.card_amount*100||0),b.$broadcast("scroll.refreshComplete")})},b.doRefresh()}]).controller("ordersController",["$rootScope","$scope","Popup","$ionicLoading","MobileService",function(a,b,c,d,e){a.currentPage="current-my-page",b.pullingTips="科技让金融更简单",b.items=[],b.doRefresh=function(){d.show({template:"<ion-spinner></ion-spinner>"}),e.getOrders().then(function(a){return d.hide(),0!=a.code?void c.alert(a.message):(a.data&&a.data.item&&a.data.item.length?b.items=a.data.item:b.items=!1,void b.$broadcast("scroll.refreshComplete"))})},b.doRefresh()}]).controller("CertificationController",["Platform","Domain","$rootScope","$scope","Popup","$ionicViewSwitcher","$location","$ionicLoading","$ionicViewSwitcher","$state","$ionicLoading","$state","MobileService",function(a,b,c,d,e,f,g,h,f,i,h,i,j){location.href=b.resolveUrl("https://h.xianjincard.com/mobile/certification");var k=g.$$search;1==k.success&&j.getConfirmLoan({money:1e3,period:14,card_type:1}).then(function(b){return 0!=b.code?void e.alert(b.message):(window.localStorage.removeItem("links"),void i.go("loan",{money:1e3,period:14,item:b.data.item,source:!!a.isWeixin}))}),d.verify=function(a){if(0===d.real_verify_status)return a.preventDefault(),void e.alert("亲，请先填写个人信息哦~",function(){})},d.doRefresh=function(){d.items=[],h.show({template:"<ion-spinner></ion-spinner>"}),j.getVerification().then(function(a){var b=[2,12,7,9,13,14],c=[3,4,8,5],e=a.data.item.list||[],f=[];for(var g in e){var i=e[g].tag;1===i?(e[g].url="#/my/certification/information",1==a.data.is_new_user&&(e[g].url+="?new_user=1")):3===i?(e[g].url="#/my/certification/contacts",1==a.data.is_new_user&&(e[g].url+="?new_user=1")):[4,8].indexOf(i)>=0&&!e[g].url&&e[g].first_url&&(e[g].url=e[g].first_url),c.indexOf(i)>=0&&(e[g].verify=1),b.indexOf(i)>=0||d.items.push(e[g]),f.push(e[g].url)}if(f.push(window.location.href+"?success=1"),a.data.is_new_user){for(var g in f)2==g?f[g]+=("?url="+f[3]).replace(/\#/g,"%23"):3==g&&(f[g]+="?url="+f[4].replace(/\#/g,"%23"));for(var g in d.items){var i=d.items[g].tag;4==i?d.items[g].url+="?url="+f[3].replace(/\#/g,"%23"):5==i&&(d.items[g].url+="?url="+f[4].replace(/\#/g,"%23"))}}window.localStorage.setItem("links",JSON.stringify(f)),d.real_verify_status=a.data.item.real_verify_status||0,h.hide(),d.$broadcast("scroll.refreshComplete")})},d.doRefresh()}]).controller("InformationController",["$scope","Domain","$location","Popup","Upload","$ionicViewSwitcher","$state","$ionicLoading","MobileService","$location","$stateParams",function(a,b,c,d,e,f,g,h,i,c,j){var k=c.$$search;a.new_user=k.new_user,void 0==k.new_user&&(a.upload=function(c,f,g){0!==f&&(h.show({template:"<ion-spinner></ion-spinner>"}),lrz(c,{width:640}).then(function(i){c.upload=e.upload({url:b.resolveUrl("http://credit.xianjincard.com/picture/upload-file"),data:{type:f,attach:i.base64,ocrtype:1},headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(b){b.data.data&&b.data.data.item&&(a.form[g]=b.data.data.item.url),h.hide(),d.alert(b.data.message)})}))},a.$watch("faces",function(b){null!=b&&a.upload(b,10,"face_recognition_picture")}),a.$watch("idNumberFront",function(b){null!=b&&a.upload(b,11,"id_number_z_picture")}),a.$watch("idNumberBack",function(b){null!=b&&a.upload(b,12,"id_number_f_picture")}),a.form={degrees_all:[{degrees:0,name:"请选择"}],degrees_default:null,company_worktype_list:[{work_type:0,name:"请选择"}],worktype_default:null}),h.show({template:"<ion-spinner></ion-spinner>"}),i.getInformation().then(function(b){if(h.hide(),0!=b.code)return void d.alert(b.message);var c=b.data;if(a.form=$.extend(!0,a.form,c.item),1==k.new_user){for(var e in a.form.degrees_all)if(a.form.degrees_all[e].degrees===a.form.degrees){a.form.degrees_default=a.form.degrees_all[e];break}for(var e in a.form.company_worktype_list)if(a.form.company_worktype_list[e].work_type===a.form.company_worktype_id){a.form.worktype_default=a.form.company_worktype_list[e];break}}}),a.save=function(a){if(h.show({template:"<ion-spinner></ion-spinner>"}),k.new_user)var b="setInformation";else{var b=a.real_verify_status?"setParsonInformation":"setInformation";a.degrees=a.degrees_default.degrees||0,a.work_type=a.worktype_default.work_type||0}i[b](a).then(function(a){h.hide(),d.alert(a.message,function(){if(0==a.code)if(1==k.new_user){var b=JSON.parse(window.localStorage.getItem("links"));window.location.href=b[1]}else f.nextDirection("back"),g.go("certification"),c.replace()})})}}]).controller("ContactsController",["$scope","Popup","$state","$location","$ionicViewSwitcher","$ionicLoading","MobileService",function(a,b,c,d,e,f,g){var h=d.$$search;a.form={lineal_list:[{type:0,name:"请选择"}],other_list:[{type:0,name:"请选择"}],lock:!1},f.show({template:"<ion-spinner></ion-spinner>"}),g.getContacts().then(function(c){if(f.hide(),0!=c.code)return void b.alert(c.message);var d=c.data;if(d&&d.item){d.item}a.form=$.extend(!0,a.form,d.item);for(var e in a.form.lineal_list)if(a.form.lineal_list[e].type===a.form.lineal_relation){a.form.lineal_default=a.form.lineal_list[e];break}for(var e in a.form.other_list)if(a.form.other_list[e].type===a.form.other_relation){a.form.other_default=a.form.other_list[e];break}}),a.save=function(a){a.lineal_relation=a.lineal_default.type||"",a.other_relation=a.other_default.type||"";var i={type:a.lineal_relation,name:a.lineal_name,mobile:a.lineal_mobile,relation_spare:a.other_relation,name_spare:a.other_name,mobile_spare:a.other_mobile};return i.mobile_spare&&11!=i.mobile.length?void b.alert("直系亲属手机号码格式错误"):i.mobile_spare&&11!=i.mobile_spare.length?void b.alert("其他联系人手机号码格式错误"):void g.setContacts(i).then(function(a){f.hide(),b.alert(a.message,function(){if(0==a.code)if(1==h.new_user){var b=JSON.parse(window.localStorage.getItem("links"));window.location.href=b[2]+"?url="+b[4].replace(/\#/g,"%23")}else e.nextDirection("back"),c.go("certification"),d.replace()})})}}]).controller("PayPasswordController",["$scope","$ionicLoading","$ionicViewSwitcher","$state","Popup","$stateParams","MobileService","Domain","$location",function(a,b,c,d,e,f,g,h,i){a.active=!1,a.data={phone:0,verify:0,loaded:0},a.form={};var j=i.$$search.state||f.state||"certification";b.show({template:"<ion-spinner></ion-spinner>"}),g.getMyInfo().then(function(c){a.data=c.data.item,a.data.verify=a.data.verify_info.real_pay_pwd_status,b.hide()}),a.save=function(f){b.show({template:"<ion-spinner></ion-spinner>"});var i="setPayPassword",k={};a.data.verify?(i="changePayPassword",k.old_pwd=f.old_pwd,k.new_pwd=f.new_pwd):k.password=f.new_pwd,g[i](k).then(function(a){b.hide(),a&&e.alert(a.message,function(){a.code>=0&&(/^(https?|\/\/)/.test(j)?window.location.href=j:"certification"==j?window.location.href=h.resolveUrl("http://h.xianjincard.com/mobile/certification"):(c.nextDirection("back"),d.go(j)))})})},a.checkout=function(b){var c=/^\d{6,}$/;a.data.verify&&(c.test(b.old_pwd)?a.active=!0:a.active=!1),c.test(b.new_pwd)&&b.new_pwd===b.confirm_pwd?a.active=!0:a.active=!1}}]).controller("FindPayPasswordController",["$scope","$location","$stateParams","$ionicViewSwitcher","$state","Popup","$ionicLoading","$q","$interval","MobileService",function(a,b,c,d,e,f,g,h,i,j){function k(){var b=h.defer(),c=60;return a.sendCodeText=[c,"秒"].join(""),a.sendCodeTimer=i(function(){c<=1&&(a.sendCodeTimer&&i.cancel(a.sendCodeTimer),b.resolve()),a.sendCodeText=[--c,"秒"].join("")},1e3),b.promise}a.active=!1,a.form={type:"find_pay_pwd",code:"",phone:"",realname:"",id_card:""};var l=b.$$search.state||c.state||"certification";g.show({template:"<ion-spinner></ion-spinner>"}),j.getBaseInformation().then(function(b){a.data=b.data.item,a.form.phone=a.data.phone,a.data.phone=function(){return a.data.phone.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2")}(),g.hide()}),a.checkout=function(b){b.id_card.length>=15&&b.code.length>=4&&b.realname?a.active=!0:a.active=!1},a.save=function(a){g.show({template:"<ion-spinner></ion-spinner>"}),j.verifyResetPayPassword(a).then(function(b){return g.hide(),b.code==-1?void f.alert(b.message):(d.nextDirection("forward"),void e.go("setpaypassword",{state:l,phone:a.phone,code:a.code}))})},a.sendCodeLock=!1,a.sendCodeFirstSend=!1,a.sendCodeFirstText="获取验证码",a.sendCodeText=a.sendCodeFirstText,a.sendCodeTimer=void 0,a.sendVerifyCode=function(){a.sendCodeLock||(a.sendCodeLock=!0,a.sendCodeFirstSend=!0,g.show({template:"<ion-spinner></ion-spinner>"}),j.sendVerifyCode(a.form).then(function(b){g.hide(),k().then(function(){a.sendCodeText="重新获取",a.sendCodeLock=!1})}))}}]).controller("SetPayPasswordController",["$scope","Popup","$state","Domain","$ionicViewSwitcher","$stateParams","$ionicLoading","MobileService",function(a,b,c,d,e,f,g,h){a.active=!1,a.form={};var i=f;""==i.phone&&""==i.code?b.alert("缺少参数",function(){e.nextDirection("back"),c.go("findpaypassword",{state:i.state})}):(a.form.phone=i.phone,a.form.code=i.code),a.checkout=function(b){/^\d{6,}/.test(b.new_pwd)&&b.new_pwd===b.confirm_pwd?a.active=!0:a.active=!1},a.save=function(a){g.show({template:"<ion-spinner></ion-spinner>"}),a.password=a.new_pwd,h.resetPayPassword(a).then(function(a){return g.hide(),a.code==-1?void b.alert(a.message):void b.alert(a.message,function(){var a=i.state||"certification";/^(https?|\/\/)/.test(a)?window.location.href=a:"certification"==a?window.location.href=d.resolveUrl("http://h.xianjincard.com/mobile/certification"):(e.nextDirection("back"),c.go(a))})})}}]).filter("removeProtocol",function(){return function(a){return a?a.replace(/^(https?):/,""):a}}).directive("noResult",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"templates/common/noresult.html"}}).directive("ngState",["$ionicViewSwitcher","$state",function(a,b){return{restrict:"A",link:function(c,d,e){angular.element(d).on("click",function(){a.nextDirection("forward"),b.go(e.ngState)})}}}]),angular.module("mobileFactory",[]).factory("MobileService",["Domain","Platform","$http","$location","$ionicPopup","$httpParamSerializerJQLike",function(a,b,c,d,e,f){var g="http://120.55.61.62/frontend/web/";return{homeVdsStatistics:function(){var b=a.resolveUrl("http://credit.xianjincard.com/activity/default/get-invite-code");return c.get(b).then(function(a){return a.data})},getHomeData:function(){var b=a.resolveUrl("http://credit.xianjincard.com/credit-app/multi-index");return c.get(b).then(function(a){return a.data})},confirmKnow:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-loan/confirm-failed-loan");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},getConfirmLoan:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-loan/get-confirm-loan");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},applyLoan:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-loan/apply-loan");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},getMyLoan:function(){var b=a.resolveUrl("http://credit.xianjincard.com/credit-loan/get-my-loan");return c({method:"POST",url:b,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},regGetCode:function(b){var d=a.resolveUrl(g+"user/check-user-register");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},login:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-user/login");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},register:function(b){var d=b.appMarket?"http://credit.xianjincard.com/credit-user/register?appMarket="+b.appMarket:"http://credit.xianjincard.com/credit-user/register";return c({method:"POST",url:a.resolveUrl(d),data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},getCode:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-user/reset-pwd-code");return b.type="find_pwd",c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},getCaptcha:function(b){var d=a.resolveUrl(g+"user/refresh-captcha");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},refreshCaptcha:function(b){var d=a.resolveUrl(g+"user/get-image-captcha?type="+(b||1));return c.get(d).then(function(a){return a.data})},checkGetCaptcha:function(b){var d=a.resolveUrl(g+"user/check-captcha-send-message");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},checkResetPwdCode:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-user/check-reset-password-code");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},resetPassword:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-user/reset-password");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},getVerification:function(){var b=a.resolveUrl("http://credit.xianjincard.com/golden/credit-card/get-verification-info");return c.get(b).then(function(a){return a.data})},getBaseInformation:function(){var b=a.resolveUrl("http://credit.xianjincard.com/credit-info/get-person-info");
return c.get(b).then(function(a){return a.data})},getInformation:function(){var b=a.resolveUrl("http://credit.xianjincard.com/credit-card/get-person-info");return c.get(b).then(function(a){return a.data})},setInformation:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-card/save-person-info");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},setParsonInformation:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-info/save-person-info");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},getContacts:function(){var b=a.resolveUrl("http://credit.xianjincard.com/credit-card/get-contacts");return c.get(b).then(function(a){return a.data})},setContacts:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-card/save-contacts");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},getOrders:function(){var b=a.resolveUrl("http://credit.xianjincard.com/credit-loan/get-my-orders");return c.get(b).then(function(a){return a.data})},getMyInfo:function(){var b=a.resolveUrl("http://credit.xianjincard.com/credit-user/get-info");return c.get(b).then(function(a){return a.data})},setPayPassword:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-user/set-paypassword");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},changePayPassword:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-user/change-paypassword");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},sendVerifyCode:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-user/reset-pwd-code");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},verifyResetPayPassword:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-user/verify-reset-password");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},resetPayPassword:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-user/reset-pay-password");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},setPayPassword:function(b){var d=a.resolveUrl("http://credit.xianjincard.com/credit-user/set-paypassword");return c({method:"POST",url:d,data:f(b),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}}).then(function(a){return a.data})},logout:function(){var b=a.resolveUrl("http://credit.xianjincard.com/credit-user/logout");return c.get(b).then(function(a){return a.data})},bindWechat:function(){var b=a.resolveUrl("http://credit.xianjincard.com/credit-user/bind-wx");return c.get(b).then(function(a){return a.data})}}}]),angular.module("mobileControllers").controller("LoginController",["$filter","$location","$rootScope","$scope","$state","Popup","$ionicViewSwitcher","$ionicLoading","MobileService",function(a,b,c,d,e,f,g,h,i){d.next=function(c){h.show({template:"<ion-spinner></ion-spinner>"}),i.regGetCode(c).then(function(c){if(h.hide(),c.code==-1)return void f.alert(c.message);var g={phone:d.form.phone,redirectUrl:b.search().redirect_url,appMarket:b.search().appMarket,invite_code:b.search().inviteCode};return d.form=null,1e3===c.code?void e.go("login-next",g):void(0===c.code&&i.getCaptcha({type:"captcha-login-reg"}).then(function(b){0==b.code&&b.data.item&&(g.codeImg=a("removeProtocol")(b.data.item)),g.isRegister=!0,e.go("reset-password",g)}))})}}]),angular.module("mobileControllers").controller("LoginNextController",["Domain","$stateParams","$location","$rootScope","$scope","$state","Popup","$ionicViewSwitcher","$ionicLoading","MobileService",function(a,b,c,d,e,f,g,h,i,j){return b.phone&&/^1\d{10}$/.test(b.phone)?(e.resetPassword=function(){h.nextDirection("forward"),f.go("reset-password",b)},e.phone=b.phone.toString().replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"),void(e.submit=function(c){i.show({template:"<ion-spinner></ion-spinner>"}),c.username=b.phone,j.login(c).then(function(c){if(i.hide(),e.form=null,0===c.code){if(b.redirectUrl)return void(location.href=b.redirectUrl);location.href=a.resolveUrl("https://h.xianjincard.com/mobile")}else g.alert(c.message)})})):void f.go("login")}]),angular.module("mobileControllers").controller("ResetPasswordController",["$filter","$window","$stateParams","$rootScope","$scope","$timeout","MobileService","$ionicLoading","$state","Popup","$location",function(a,b,c,d,e,f,g,h,i,j,k){if(!c.phone||!/^1\d{10}$/.test(c.phone)){if(!b.localStorage.getItem("phone"))return void i.go("login");c.phone=b.localStorage.getItem("phone"),c.isRegister=b.localStorage.getItem("isRegister"),c.invite_code=b.localStorage.getItem("invite_code"),b.localStorage.removeItem("phone"),b.localStorage.removeItem("invite_code"),b.localStorage.removeItem("isRegister")}e.codeText="发送验证码",e.sendDisabled=!1,e.isAgress=!0,e.codeImg=null,e.codeError=!1,e.onAgree=function(){e.isAgress=!e.isAgress},e.onHref=function(a){a.stopPropagation(),b.localStorage.setItem("phone",c.phone),b.localStorage.setItem("isRegister",c.isRegister),b.localStorage.setItem("invite_code",c.invite_code),location.href="//api.xianjincard.com/page/detail?id=535"};var l=function(a,b){f(function(){e.codeText=a+"秒后重试",a?l(--a,1e3):(e.codeText="重新发送",e.sendDisabled=!1)},b)};e.sendCode=function(){h.show({template:"<ion-spinner></ion-spinner>"});var b=c.isRegister?"regGetCode":"getCode";g[b]({phone:c.phone}).then(function(b){return h.hide(),0!==b.code?void j.alert(b.message):void(b.data.item?e.codeImg=a("removeProtocol")(b.data.item):(e.sendDisabled=!0,l(60)))})},e.refresh=function(){var b={type:"captcha-login-reg"};g.getCaptcha(b).then(function(b){0===b.code?(e.codeImg=a("removeProtocol")(b.data.item),e.codeError=!1,document.getElementById("verifyForm").reset()):j.alert(b.message)})},e.verifyCode=function(a){a.phone=c.phone;var b=c.isRegister?"checkGetCaptcha":"checkResetPwdCode";c.isRegister||(a.type="find_pwd"),g[b](a).then(function(a){return a.code===-1?void j.alert(a.message):a.code===-3?void(e.codeError=!0):void(0===a.code&&(document.getElementById("verifyForm").reset(),e.codeImg=null,e.codeError=!1,e.sendDisabled=!0,l(60)))})};var m=c.isRegister?"register":"resetPassword";c.isRegister&&(c.source=51,c.codeImg?e.codeImg=a("removeProtocol")(c.codeImg):(e.sendDisabled=!0,l(60))),e.reset=function(a){h.show({template:"<ion-spinner></ion-spinner>"}),angular.extend(a,c),g[m](a).then(function(a){return h.hide(),e.form=null,0!==a.code?void j.alert(a.message):void(0===a.code&&(i.go("login-next",c),k.replace()))})}}]);